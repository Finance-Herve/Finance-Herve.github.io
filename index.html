<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Suivi Financier</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    #solde { font-size: 1.5em; font-weight: bold; }
    #user-info { cursor: pointer; }
    #transaction-form { margin-bottom: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    .hidden { display: none; }
    .logout-btn { color: red; cursor: pointer; font-size: 0.9em; }
  </style>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-auth-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database-compat.js"></script>
</head>
<body>
  <header>
    <div id="solde">Solde : 0 FCFA</div>
    <div id="user-info">
      <img src="https://ssl.gstatic.com/ui/v1/icons/mail/rfr/logo_gmail_lockup_default_1x_r2.png" width="100" alt="Gmail">
      <div id="user-email" class="hidden"></div>
      <div class="logout-btn hidden" onclick="logout()">Se déconnecter</div>
    </div>
  </header>

  <form id="transaction-form">
    <input type="text" id="description" placeholder="Description" required>
    <input type="number" id="montant" placeholder="Montant" required>
    <select id="type">
      <option value="bénéfice">Bénéfice</option>
      <option value="dette">Dette</option>
    </select>
    <input type="date" id="date" placeholder="Date" required>
    <button type="submit">Ajouter</button>
  </form>

  <table>
    <thead>
      <tr>
        <th>Description</th>
        <th>Montant</th>
        <th>Type</th>
        <th>Date</th>
      </tr>
    </thead>
    <tbody id="transaction-table"></tbody>
  </table>

  <script>
    const firebaseConfig = {
      apiKey: "VOTRE_API_KEY",
      authDomain: "VOTRE_DOMAINE.firebaseapp.com",
      projectId: "VOTRE_ID_PROJET",
      storageBucket: "VOTRE_BUCKET.appspot.com",
      messagingSenderId: "ID_MESSAGERIE",
      appId: "VOTRE_APP_ID",
      databaseURL: "https://VOTRE_ID_PROJET.firebaseio.com"
    };
    firebase.initializeApp(firebaseConfig);

    const auth = firebase.auth();
    const db = firebase.database();

    let currentUser = null;

    function updateSolde(transactions) {
      let solde = 0;
      transactions.forEach(data => {
        const montant = Number(data.montant);
        if (data.type === "bénéfice") solde += montant;
        else if (data.type === "dette") solde -= montant;
      });
      document.getElementById("solde").innerText = `Solde : ${solde} FCFA`;
    }

    function afficherTransactions(data) {
      const tbody = document.getElementById("transaction-table");
      tbody.innerHTML = "";
      const transactions = [];
      for (let key in data) {
        const d = data[key];
        transactions.push(d);
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${d.description}</td>
          <td>${d.montant}</td>
          <td>${d.type}</td>
          <td>${d.date}</td>
        `;
        tbody.appendChild(row);
      }
      updateSolde(transactions);
    }

    function fetchData() {
      if (!currentUser) return;
      db.ref("transactions/" + currentUser.uid).on("value", (snapshot) => {
        const data = snapshot.val() || {};
        afficherTransactions(data);
      });
    }

    document.getElementById("transaction-form").addEventListener("submit", (e) => {
      e.preventDefault();
      const description = document.getElementById("description").value;
      const montant = document.getElementById("montant").value;
      const type = document.getElementById("type").value;
      const date = document.getElementById("date").value;
      const id = Date.now();

      db.ref("transactions/" + currentUser.uid + "/" + id).set({
        description,
        montant,
        type,
        date
      });

      e.target.reset();
    });

    document.getElementById("user-info").addEventListener("click", () => {
      const emailEl = document.getElementById("user-email");
      const logoutEl = document.querySelector(".logout-btn");
      emailEl.classList.toggle("hidden");
      logoutEl.classList.toggle("hidden");
    });

    function logout() {
      auth.signOut();
      location.reload();
    }

    auth.onAuthStateChanged((user) => {
      if (user) {
        currentUser = user;
        document.getElementById("user-email").innerText = user.email;
        fetchData();
      } else {
        const email = prompt("Entrez votre email :");
        const password = prompt("Mot de passe :");
        auth.signInWithEmailAndPassword(email, password)
          .catch(() => auth.createUserWithEmailAndPassword(email, password));
      }
    });
  </script>
</body>
</html>
